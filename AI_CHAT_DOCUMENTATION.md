# Диалоговое окно чата с AI-ассистентом

## Обзор

Разработано полнофункциональное диалоговое окно чата с AI-ассистентом для системы управления договорами. Компонент обеспечивает интуитивный интерфейс для взаимодействия с искусственным интеллектом через LM Studio.

## Основные компоненты

### 1. AIChatDialog (`/src/components/ai-assistant/ai-chat-dialog.tsx`)

Основное диалоговое окно чата со следующими возможностями:

- **Многооконный интерфейс** с вкладками:
  - Чат - основной диалог с AI-ассистентом
  - Сценарии - готовые шаблоны запросов
  - Настройки - параметры модели и статус системы

- **Функциональность чата**:
  - Отправка и получение сообщений в реальном времени
  - История диалогов с сохранением
  - Автопрокрутка к новым сообщениям
  - Поддержка многострочного ввода (Enter для отправки, Shift+Enter для новой строки)

- **Готовые сценарии**:
  - Анализ рисков договора
  - Создание карточки договора
  - Вопросы о договоре
  - Подготовка уведомлений
  - Поиск аналогичных договоров

- **Управление окном**:
  - Минимизация/максимизация
  - Статус подключения к LM Studio
  - Очистка истории чата

### 2. AIAssistantFloatingButton (`/src/components/ai-assistant/ai-assistant-floating-button.tsx`)

Плавающая кнопка для быстрого доступа к AI-ассистенту:

- Фиксированное положение в нижнем правом углу
- Индикатор непрочитанных сообщений
- Интеграция с системой уведомлений

### 3. AIAssistantNotification (`/src/components/ai-assistant/ai-assistant-notification.tsx`)

Система уведомлений о новых сообщениях:

- Автоматическое появление при новых сообщениях
- Анимированное отображение
- Кнопки быстрого доступа к чату
- Автоскрытие через 10 секунд

## Интеграция с главным приложением

### Главная страница (`/src/app/page.tsx`)

- Кнопка "AI-ассистент" в заголовке страницы
- Блок быстрых действий AI-ассистента
- Плавающая кнопка для доступа из любой точки страницы
- Полноценная интеграция с системой авторизации

## API endpoints

### 1. `/api/ai-assistant` (POST/GET)

- **POST**: Обработка сообщений и взаимодействие с LM Studio
- **GET**: Проверка статуса подключения к LM Studio

### 2. `/api/ai-assistant/history` (GET/POST/DELETE)

- **GET**: Загрузка истории диалогов
- **POST**: Сохранение новых сообщений
- **DELETE**: Очистка истории чата

### 3. `/api/ai-settings` (GET/POST)

- **GET**: Получение настроек AI-ассистента
- **POST**: Обновление настроек и тестирование подключения

## Функциональные возможности

### Чат с AI-ассистентом

1. **Отправка сообщений**:
   - Текстовый ввод с поддержкой многострочности
   - Валидация перед отправкой
   - Индикация набора сообщения

2. **Получение ответов**:
   - Отображение ответов от AI
   - Форматирование временных меток
   - Различие стилей для сообщений пользователя и ассистента

3. **История диалогов**:
   - Автоматическое сохранение сообщений
   - Загрузка истории при открытии
   - Возможность очистки истории

### Готовые сценарии

1. **Анализ рисков**:
   - Сравнение с типовыми условиями
   - Оценка уровня риска
   - Предложения по улучшению

2. **Создание карточки договора**:
   - Автоматическое извлечение данных
   - Проверка соответствия требованиям
   - Формирование структурированного ответа

3. **Вопросы о договоре**:
   - Контекстные ответы
   - Использование только предоставленной информации
   - Указание на отсутствие данных

4. **Подготовка уведомлений**:
   - Генерация официальных писем
   - Учет реквизитов из договора
   - Сохранение делового стиля

5. **Поиск аналогов**:
   - Поиск релевантных договоров
   - Учет множества критериев
   - Обоснование выбора

### Система уведомлений

1. **Индикаторы**:
   - Счетчик непрочитанных сообщений
   - Визуальные уведомления
   - Анимированные эффекты

2. **Взаимодействие**:
   - Быстрый переход к чату
   - Отклонение уведомлений
   - Автоматическое скрытие

## Технические особенности

### Используемые технологии

- **Frontend**: React, TypeScript, Tailwind CSS, shadcn/ui
- **State Management**: React hooks
- **API**: Next.js API routes
- **AI Integration**: LM Studio API
- **Icons**: Lucide React

### Компоненты UI

- Диалоговые окна
- Кнопки и значки
- Индикаторы состояния
- Прокручиваемые области
- Вкладки и контент
- Уведомления

### Обработка ошибок

- Валидация входных данных
- Обработка ошибок сети
- Индикация состояния подключения
- Сообщения об ошибках для пользователя

## Безопасность

- Проверка авторизации пользователя
- Валидация всех входных данных
- Безопасное хранение настроек
- Защита от XSS-атак

## Производительность

- Оптимизированная загрузка компонентов
- Эффективное управление состоянием
- Минимизация перерисовок
- Кэширование настроек

## Доступность

- Семантическая HTML-разметка
- ARIA-атрибуты для скринридеров
- Клавиатурная навигация
- Контрастность цветов

## Будущие улучшения

1. **Расширение функционала**:
   - Голосовой ввод/вывод
   - Поддержка файлов и документов
   - Интеграция с другими системами

2. **Улучшение UI/UX**:
   - Темная тема
   - Адаптивный дизайн для мобильных
   - Анимации и переходы

3. **Оптимизация**:
   - WebSockets для реального времени
   - Офлайн-режим
   - Улучшенное кэширование

## Использование

### Для пользователя:

1. Нажмите кнопку "AI-ассистент" в заголовке страницы или плавающую кнопку
2. Выберите готовый сценарий или задайте свой вопрос
3. Получайте ответы от AI-ассистента в реальном времени
4. Используйте историю диалогов для продолжения работы

### Для разработчика:

1. Импортируйте необходимые компоненты:
```typescript
import AIChatDialog from '@/components/ai-assistant/ai-chat-dialog'
import AIAssistantFloatingButton from '@/components/ai-assistant/ai-assistant-floating-button'
```

2. Используйте компоненты в приложении:
```typescript
<AIChatDialog
  open={isChatOpen}
  onOpenChange={setIsChatOpen}
  userId={user?.id}
  contractId={contractId}
  contractData={contractData}
/>

<AIAssistantFloatingButton
  userId={user?.id}
  contractId={contractId}
  contractData={contractData}
/>
```

3. Настройте API endpoints для взаимодействия с LM Studio

## Заключение

Разработанное диалоговое окно чата с AI-ассистентом предоставляет мощный и удобный инструмент для работы с договорами. Интеграция с существующей системой, интуитивный интерфейс и расширенные функциональные возможности делают его незаменимым помощником для пользователей системы управления договорами.